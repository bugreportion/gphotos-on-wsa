# Безлимитнное копирование фото в облако на WSA

## Вводные данные
1. Фото и видео обязательно должны быть скопированы во внутреннюю память подсистемы (userdata.vhdx), иначе процесс не пойдёт. Сделать это можно только из-под непосредственно самой WSA.
2. Если объем выгружаемого медиа слишком большой, рекомендуется перенести подсистему на другой диск (желательно SSD) во избежание переполнения пространства на основном системном разделе, где по умолчанию располагается диск WSA.
3. **Модуль [Google Photos Unlimited Zygisk](https://gitlab.com/cuynu/gphotos-unlimited-zygisk) на WSA работает некорректно!** Следуйте инструкции, чтобы завести исправный безлимитный бекап.

## Установка
1. [Скачиваем желаемый тип сборки](https://github.com/MustardChef/WSABuilds/releases/) (рекомендую использовать вариант KernelSU + MindTheGapps + RemovedAmazon, с другими возникали проблемы).
2. Если вы хотите:
   - установить подсистему на основном системном разделе, здесь всё как обычно: распаковываем папку из архива в любое удобное место, откуда впоследствии **не удаляем**, переименовываем её в `WSA` и запускаем `Run.bat`.
   - установить подсистему на другом разделе:
     - распаковывам папку из архива в любое удобное место на нужном диске, откуда впоследствии **не удаляем**, переименовывам её в `WSA` и запускаем `Run.bat`.  
     - после первого запуска переходим в приложение "Подсистема Windows для Android" и завершаем работу подсистемы кнопкой **Отключить.**
     - открываем окно "Выполнить" (Win + R), переходим `%LOCALAPPDATA%/Packages/MicrosoftCorporationII.WindowsSubsystemForAndroid_8wekyb3d8bbwe/LocalCache`
     - вырезаем файлы metadata.vhdx и userdata.vhdx и переносим на нужный диск (можно в ту папку, откуда изначально установили WSA). Файлы могут иметь несколько отличное название, например userdata.**2**.vhdx.
     - скачиваем и устанавливаем [Link Shell Extension](https://schinagl.priv.at/nt/hardlinkshellext/linkshellextension.html#download), или:
       - `choco install linkshellextension`
       - `winget install HermannSchinagl.LinkShellExtension`
     - переходим к перенесенным файлам уже в новых директориях. ПКМ по файлу userdata.vhdx → (Windows 11) Показать дополнительные параметры → Запомнить источник ссылки.  
Переходим обратно в `%LOCALAPPDATA%/Packages/MicrosoftCorporationII.WindowsSubsystemForAndroid_8wekyb3d8bbwe/LocalCache` → ПКМ → Поместить как... → Символическую ссылку.  
Тоже самое делаем с файлом metadata.vhdx.
Мы перенесли WSA на другой диск.
3. Входим в аккаунт Google. Скачиваем приложение Google Фото. Переходим в приложение Подсистема Windows для Android → Дополнительные параметры → Экспериментальные функции → Предоставить общий доступ к папкам пользователей (включаем этот параметр) → выбираем путь до папки с контентом, который хотим выгрузить.
4. Скачиваем и устанавливаем [менеджер KernelSU,](https://github.com/tiann/KernelSU/releases) затем модули [Zygisk Next](https://github.com/Dr-TSNG/ZygiskNext/releases) и [LSPosed.](https://github.com/begoniacommunity/list/blob/files/lsposed_no-logs.zip) Перезагружаем подсистему.
> Как установить приложение через adb [(должен быть установлен пакет Platform-tools)](https://github.com/SunsetTechuila/Platform-Tools-Installer): переходим в приложение Подсистема Windows для Android → Дополнительные параметры → Режим разработчика. Открываем Терминал и подключаемся по указанному адресу, например:
adb connect `127.0.0.1:73924` (не обращайте внимание на ошибку failed to authunticate). Подтвержаем подключение во всплывающем окне Android'a кнопкой Разрешить. Теперь выполняем команду установки, например `adb install KernelSU.apk`.
6. Открываем менеджер LSPosed через уведомление или скачиваем его с [Google Play,](https://play.google.com/store/apps/details?id=org.lsposed.manager&hl=ru) затем устанавливаем модуль [Pixelify Google Photos](https://github.com/BaltiApps/Pixelify-Google-Photos/releases) и активируем его в LSPosed.
7. Запускаем приложение Pixelify GPhotos, выбираем Device to spoof → Pixel XL. Проверяем меню Customize feature flags, должен быть отмечен только пункт Pixel 2016. Перезагружаем подсистему.
8. Открываем приложение Google Фото и идем в меню аккаунта – если всё успешно, видим надпись *Копировать в облако фотографии и видео с этого устройства Pixel можно бесплатно и в любом объеме.*
9. Скачиваем и устаналиваем [Material Files.](https://github.com/zhanghai/MaterialFiles/releases) Наши файлы находятся в папке `Windows`. Переносим их во внутреннюю память WSA (например, в DCIM). Ограничение пространства подсистемы – 130 ГБ. Если объем медиа превышает доступный, просто разбейте вашу выгрузку на несколько частей.
10. Возвращаемся в Google Фото и включаем копирование фото в облако. Процесс выгрузки начнётся автоматически, отследить его можно в меню аккаунта.

## Подтверждение
![proof](https://github.com/user-attachments/assets/42c0abb6-9044-42cd-aead-f154b86322e4)

## Дополнительная информация
* А что не так с модулем [Google Photos Unlimited Zygisk?](https://gitlab.com/cuynu/gphotos-unlimited-zygisk)  
Модуль, по всей видимости, некорректно патчит фичерс-флаги устройства на эмуляторе, из-за чего оно как бы определяется в качестве Pixel XL, но при выгрузке в облако, фотографии все равно занимают место в бесплатном хранилище. 
* Почему рекомендуется сборка с KernelSU, а не Magisk Canary?  
На момент написания текста, установка последней актуальной сборки с Magisk Canary на раздел, отличный от системного, выпадает в неизвестные ошибки, в результате чего не устанавливается ни Magisk, ни Сервисы Google Play. 
